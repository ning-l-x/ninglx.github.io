<!doctype html><html lang="en"><head><meta charset="utf-8"><script src="04eef697c9f00e4ec3c7.js"></script><script src="d8aec11467019c7f95d5.js"></script><script src="0c9b330400cba6d82e78.js"></script><script src="f9ab8d7da3a4af254b22.js"></script><script src="fc2b057ebd1a3c3e20d6.js"></script><link rel="stylesheet" href="13bb7e9048f30a02c70d.css"/><link rel="stylesheet" href="e641a99aa5d1d6f27c0d.css"/><link rel="stylesheet" href="86367996bc0a30d7968b.css"/><script defer="defer" src="bundle.js"></script></head><body><style>#app,body,html{height:100%;width:100%;overflow:hidden;position:relative}#map{width:99%;height:99%}.rightTopButtons{display:flex;justify-content:space-between}.ctrlPanel{position:absolute;border-radius:4px;left:10px;top:10px;padding:8px;background-color:rgba(255,255,255,.25);backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px);border:1px solid rgba(255,255,255,.18);box-shadow:rgba(142,142,142,.19) 0 6px 15px 0;-webkit-box-shadow:rgba(142,142,142,.19) 0 6px 15px 0;-webkit-border-radius:4px;color:rgba(255,255,255,.75);width:280px}.panelItem{margin-bottom:5px;width:100%}.mybuttons{display:flex;justify-content:space-between}.drawResult{position:absolute;border-radius:4px;right:70px;top:10px;padding:8px;background-color:#fff;color:rgba(255,255,255,.75);width:300px}</style><div id="app"><div id="map"></div><div class="ctrlPanel"><div class="panelItem"><el-input class="panelItem" size="mini" placeholder="输入经纬度 用英文逗号,隔开" v-model="lnglatStr"></el-input><el-button type="primary" class="panelItem" size="mini" @click="locate">定位</el-button></div><el-divider></el-divider><div class="panelItem"><el-input class="panelItem" size="mini" placeholder="输入合法的 styleUrl" v-model="styleValue"></el-input><el-button type="primary" class="panelItem" size="mini" @click="replaceStyle">替换 Style</el-button></div><el-divider></el-divider><div class="panelItem"><el-input type="textarea" :rows="6" class="panelItem" size="mini" placeholder="输入合法的 features 数据 (参考右侧生成数据格式)" v-model="drawGeojsonValue"></el-input><div class="panelItem"><el-button type="primary" style="width:calc(50% - 8px)" size="mini" @click="drawGeojson">绘制</el-button><el-button type="primary" style="width:calc(50% - 8px)" size="mini" @click="clearGeojson(true)">清除</el-button></div></div><el-divider></el-divider><div class="panelItem"><el-input type="textarea" :rows="2" class="panelItem" size="mini" placeholder="输入合法的 raster tile url" v-model="rasterLayerUrl"></el-input><div class="panelItem"><el-button type="primary" style="width:calc(50% - 8px)" size="mini" @click="addRasterLayer">添加栅格Raster</el-button><el-button type="primary" style="width:calc(50% - 8px)" size="mini" @click="removeRasterLayer">移除</el-button></div></div><el-divider></el-divider><div class="panelItem"><el-input type="textarea" :rows="2" class="panelItem" size="mini" placeholder="输入合法的 vector tile url" v-model="vectorTileUrl"></el-input><el-input class="panelItem" placeholder="输入 vector 的对应 source-layer" v-model="vectorSourceLayer"></el-input><div class="panelItem"><el-button type="primary" style="width:calc(50% - 8px)" size="mini" @click="addVectorLayer">添加矢量Vector</el-button><el-button type="primary" style="width:calc(50% - 8px)" size="mini" @click="removeVectorLayer">移除</el-button></div></div></div><div class="drawResult"><el-input style="margin-bottom:8px" placeholder="绘制工具最近一条绘制/更新结果" type="textarea" :rows="6" v-model="drawResultText"></el-input><div class="rightTopButtons"><el-button type="primary" size="mini" @click="removeTerrain">删除地形</el-button><el-button type="primary" size="mini" @click="addTerrain">添加地形</el-button><el-button type="primary" size="mini" @click="copyResult">复制</el-button></div></div></div><script>let map=null;new Vue({el:"#app",data:function(){return{visible:!1,lnglatStr:"",drawResultText:"",styleValue:"",drawGeojsonValue:"",rasterLayerUrl:"",vectorTileUrl:"",vectorSourceLayer:""}},methods:{addTerrain(){map.setTerrain({source:"mapbox-dem",exaggeration:1.5})},removeTerrain(){map.setTerrain(null)},addVectorLayer(){map.getSource("vectorSource")||map.addSource("vectorSource",{type:"vector",tiles:[this.vectorTileUrl]}),map.getLayer("vectorLayer")||map.addLayer({id:"vectorLayer",type:"circle",source:"vectorSource","source-layer":this.vectorSourceLayer,paint:{"circle-color":"red","circle-radius":2}})},removeVectorLayer(){map.getLayer("vectorLayer")&&map.removeLayer("vectorLayer"),map.getSource("vectorSource")&&map.removeSource("vectorSource")},addRasterLayer(){if(map.getLayer("customRaster-layer"))this.$notify.warning({title:"请先移除已存在栅格图层！"});else{let e={id:"customRaster-layer",type:"raster",source:{type:"raster",tiles:[this.rasterLayerUrl],tileSize:256}};map.addLayer(e)}},removeRasterLayer(){map.getLayer("customRaster-layer")&&(map.removeLayer("customRaster-layer"),map.removeSource("customRaster-layer")),this.rasterLayerUrl=""},clearGeojson(e){map.getLayer("customSource-layer")&&(map.removeLayer("customSource-layer"),map.removeSource("customSource")),e&&(this.drawGeojsonValue="")},drawGeojson(){if(this.clearGeojson(),this.drawGeojsonValue){let e=turf.featureCollection(JSON.parse(this.drawGeojsonValue));map.getSource("customSource")?map.getSource("customSource").setData(e):(map.addSource("customSource",{type:"geojson",data:e}),"LineString"===e.features[0].geometry.type&&map.addLayer({id:"customSource-layer",type:"line",source:"customSource",paint:{"line-color":"red","line-width":2}}),"Polygon"===e.features[0].geometry.type&&map.addLayer({id:"customSource-layer",type:"fill",source:"customSource",paint:{"fill-color":"rgba(243, 15, 53,0.5)"}}),"Point"===e.features[0].geometry.type&&map.addLayer({id:"customSource-layer",type:"circle",source:"customSource",paint:{"circle-color":"red","circle-radius":10}}))}},replaceStyle(){try{map.setStyle(this.styleValue)}catch(e){this.$notify.error({title:"输入非法！",message:e})}},locate(e){console.log(e);try{let e=this.lnglatStr.split(",");map.flyTo({center:e,zoom:18})}catch(e){this.$notify.error({title:"输入非法！",message:e})}},copyResult(){const e=document.createElement("input");e.setAttribute("readonly","readonly"),e.setAttribute("value",this.drawResultText),document.body.appendChild(e),e.setSelectionRange(0,9999),e.select(),document.execCommand("copy"),document.body.removeChild(e),this.$notify.success({title:"复制成功！"})}},mounted(){mapboxgl.accessToken="pk.eyJ1IjoibmluZ2x4IiwiYSI6ImNsYnlnM2s2ODBnNmIzcHBpbzY5aDh3bHAifQ.hQL4zLjBss5i4x-zuFp9tg",map=new mapboxgl.Map({container:"map",style:"mapbox://styles/mapbox/satellite-streets-v12",center:[110.70727046509603,33.05124063231834],zoom:2});var e=new MapboxDraw({displayControlsDefault:!1,controls:{polygon:!0,line_string:!0,point:!0,trash:!0}});map.addControl(e),map.on("load",(()=>{map.on("click",(e=>{console.log(e.lngLat),console.log(map.getCenter()),console.log(map.getBearing()),console.log(map.getZoom()),console.log(map.getPitch())})),setTimeout((()=>{map.flyTo({center:[116.15090301724723,40.006045007062],bearing:-73.60786512235785,zoom:14.754889002122209,pitch:70.99850391694255})}),2e3)})),map.on("style.load",(()=>{map.addSource("mapbox-dem",{type:"raster-dem",url:"mapbox://mapbox.mapbox-terrain-dem-v1",tileSize:512,maxzoom:14}),this.addTerrain()})),map.on("draw.create",(e=>{let r=JSON.stringify(e.features);this.drawResultText=r})),map.on("draw.update",(e=>{let r=JSON.stringify(e.features);this.drawResultText=r}))}})</script></body></html>