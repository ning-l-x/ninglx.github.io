<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.1.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"ninglx.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":true},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="html, 		body, 		#app { 			height: 100%; 			width: 100%; 			overflow: hidden; 			position: relative; 		}  		#map { 			width: 99%; 			height: 99%; 		}  		.rightTopButton">
<meta property="og:type" content="website">
<meta property="og:title" content="Ning">
<meta property="og:url" content="http://ninglx.github.io/demos/edit/mapbox/index.html">
<meta property="og:site_name" content="Ning">
<meta property="og:description" content="html, 		body, 		#app { 			height: 100%; 			width: 100%; 			overflow: hidden; 			position: relative; 		}  		#map { 			width: 99%; 			height: 99%; 		}  		.rightTopButton">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-09-07T05:37:27.897Z">
<meta property="article:modified_time" content="2023-09-07T05:37:27.897Z">
<meta property="article:author" content="Ning lx">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://ninglx.github.io/demos/edit/mapbox/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title> | Ning
</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?71b22babdc8da0b8a4c38614720f6a5e";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Ning</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-mapbox">

    <a href="/demos/map/mapbox/index.html" rel="section"><i class="fa fa-map-marked fa-fw"></i>mapbox</a>

  </li>
        <li class="menu-item menu-item-cesium">

    <a href="/demos/map/cesium/index.html" rel="section"><i class="fa fa-map-marked fa-fw"></i>cesium</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">19</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">2</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">28</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/ninglx" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
  
  

          <div class="content page posts-expand">
            

    
    
    
    <div class="post-block" lang="zh-CN">
      <header class="post-header">

<h1 class="post-title" itemprop="name headline">
</h1>

<div class="post-meta">
  
  <ul class="breadcrumb">
          
            <li><a href="/demos/">DEMOS</a></li>
            <li><a href="/demos/edit/">EDIT</a></li>
          <li>MAPBOX</li>
        
  </ul>

</div>

</header>

      
      
      
      <div class="post-body">
          <!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<script src="./libs/vue.js"></script>
	<script src="./libs/element-ui.js"></script>
	<script src="./libs/mapbox-gl-draw.js"></script>
	<script src="./libs/mapbox-gl.js"></script>
	<script src="./libs/turf.min.js"></script>
	<script src="./libs/threebox/threebox.js"></script>
	<link rel='stylesheet' href="./libs/mapbox-gl-draw.css" type='text/css' />
	<link rel='stylesheet' href="./libs/mapbox-gl.css" />
	<link rel='stylesheet' href="./libs/theme-chalk_index.css" />
	<link rel='stylesheet' href="./libs/threebox/threebox.css" />
</head>

<body>
	<style>
		html,
		body,
		#app {
			height: 100%;
			width: 100%;
			overflow: hidden;
			position: relative;
		}

		#map {
			width: 99%;
			height: 99%;
		}

		.rightTopButtons {
			display: flex;
			justify-content: space-between;
		}

		.ctrlPanel {
			position: absolute;
			border-radius: 4px;
			left: 10px;
			top: 10px;
			padding: 8px;
			background-color: rgba(255, 255, 255, 0.25);
			backdrop-filter: blur(6px);
			-webkit-backdrop-filter: blur(6px);
			border: 1px solid rgba(255, 255, 255, 0.18);
			box-shadow: rgba(142, 142, 142, 0.19) 0px 6px 15px 0px;
			-webkit-box-shadow: rgba(142, 142, 142, 0.19) 0px 6px 15px 0px;
			-webkit-border-radius: 4px;
			color: rgba(255, 255, 255, 0.75);
			width: 280px;
			/* height: 500px; */
		}

		.panelItem {
			margin-bottom: 5px;
			width: 100%;
		}

		.mybuttons {
			display: flex;
			justify-content: space-between;
		}

		.drawResult {
			position: absolute;
			border-radius: 4px;
			right: 70px;
			top: 10px;
			padding: 8px;
			background-color: rgba(255, 255, 255, 1);
			color: rgba(255, 255, 255, 0.75);
			width: 300px;
			/* height: 200px; */
		}

		.el-slider {
			padding-right: 5px;
			width: calc(58% - 36px);
		}

		.slider-box {
			position: absolute;
			z-index: 1;
			display: flex;
			align-items: center;
			padding: 8px 34px;
			background-color: rgba(255, 255, 255, 0.25);
			border-radius: 34px;
			backdrop-filter: blur(6px);
			-webkit-backdrop-filter: blur(6px);
			border: 1px solid rgba(255, 255, 255, 0.18);
			box-shadow: rgba(142, 142, 142, 0.19) 0px 6px 15px 0px;
			-webkit-box-shadow: rgba(142, 142, 142, 0.19) 0px 6px 15px 0px;
			width: 455px;
			height: 48px;
			left: 50%;
			bottom: 15px;
			transform: translateX(-50%);
		}

		.slider-text {
			color: white;
			display: inline-block;
			width: 90px;
			text-align: center;
		}

		.ctrl-select {
			width: 120px;
		}

		.play-icon {
			font-size: 22px;
			color: white;
			cursor: pointer;
			margin-right: 20px;
			font-weight: 700;
		}
	</style>
	<div id="app">
		<div id="map"></div>
		<div class="ctrlPanel">
			<div class="panelItem">
				<el-input class="panelItem" size="mini" placeholder="输入经纬度 用英文逗号,隔开" v-model="lnglatStr"></el-input>
				<el-button type="primary" class="panelItem" size="mini" @click="locate">定位</el-button>
			</div>
			<el-divider></el-divider>
			<div class="panelItem">
				<el-input class="panelItem" size="mini" placeholder="输入合法的 styleUrl" v-model="styleValue"></el-input>
				<el-button type="primary" class="panelItem" size="mini" @click="replaceStyle">替换 Style</el-button>
			</div>
			<el-divider></el-divider>
			<div class="panelItem">
				<el-input type="textarea" :rows="6" class="panelItem" size="mini" placeholder="输入合法的 features 数据 (参考右侧生成数据格式)"
					v-model="drawGeojsonValue"></el-input>
				<div class="panelItem">
					<el-button type="primary" style="width:calc(50% - 8px)" size="mini" @click="drawGeojson">绘制</el-button>
					<el-button type="primary" style="width:calc(50% - 8px)" size="mini" @click="clearGeojson(true)">清除</el-button>
				</div>
			</div>
			<el-divider></el-divider>
			<div class="panelItem">
				<el-input type="textarea" :rows="2" class="panelItem" size="mini" placeholder="输入合法的 raster tile url"
					v-model="rasterLayerUrl"></el-input>
				<div class="panelItem">
					<el-button type="primary" style="width:calc(50% - 8px)" size="mini"
						@click="addRasterLayer">添加栅格Raster</el-button>
					<el-button type="primary" style="width:calc(50% - 8px)" size="mini" @click="removeRasterLayer"> 移除</el-button>
				</div>
			</div>
			<el-divider></el-divider>
			<div class="panelItem">
				<el-input type="textarea" :rows="2" class="panelItem" size="mini" placeholder="输入合法的 vector tile url"
					v-model="vectorTileUrl"></el-input>
				<el-input class="panelItem" placeholder="输入 vector 的对应 source-layer" v-model="vectorSourceLayer"></el-input>
				<div class="panelItem">
					<el-button type="primary" style="width:calc(50% - 8px)" size="mini"
						@click="addVectorLayer">添加矢量Vector</el-button>
					<el-button type="primary" style="width:calc(50% - 8px)" size="mini" @click="removeVectorLayer"> 移除</el -
							button>
				</div>
			</div>
			<el-divider></el-divider>
			<div class="panelItem">
				<el-button type="primary" style="width:100%" size="mini" @click="openThree">打开Three-Map</el-button>
			</div>
		</div>
		<div class="drawResult">
			<el-input style="margin-bottom: 8px;" placeholder="绘制工具最近一条绘制/更新结果" type="textarea" :rows="6"
				v-model="drawResultText"></el-input>
			<div class="rightTopButtons">
				<el-button type="primary" size="mini" @click="addTerrain">添加地形</el-button>
				<el-button type="primary" size="mini" @click="removeTerrain">删除地形</el-button>

				<el-button type="primary" size="mini" @click="copyResult"> 复制</el-button>
			</div>

		</div>
		<el-dialog @open="dialogOpen" @close="closeDialog" top="5vh" title="Three-Map 轨迹播放示例" :visible.sync="dialogVisible"
			width="70%" :destroy-on-close="true">
			<div id="threeMapContainer" style="height: 65vh;">
				<div class="slider-box">
					<i class="play-icon" :class="playStatus?'el-icon-video-pause':'el-icon-video-play'" @click="playClick"></i>
					<el-slider ref="sliderRef" v-model="currentTime" :disabled="duration === 0" :min="0" :max="duration"
						:show-tooltip="false" @mousedown="handleMouseDown" @mouseup="handleMouseUp"
						@change="handleTimeChange"></el-slider>
					<span class="slider-text" id="slider-text"></span>
					<el-select size="small" v-model="speed" class="ctrl-select">
						<el-option v-for="item of speeds" :key="item.value" :label="item.label" :value="item.value"></el-option>
					</el-select>
				</div>
			</div>

			<div style="text-align: center;width: 100%;margin-top: 20px;">
				<el-button type="danger" size="mini" @click="closeDialog">关闭</el-button>
			</div>
		</el-dialog>
	</div>
	<script>
		let map = null, dMap = null, models = {}, fullTrack = [], dillPath = [], lastFrame = {}, colorMap = {}
		new Vue({
			el: '#app',
			data: function () {
				return {
					visible: false, lnglatStr: '', drawResultText: '', styleValue: '', drawGeojsonValue: '', rasterLayerUrl: '', vectorTileUrl: '', vectorSourceLayer: '',
					// ----
					dialogVisible: false, modelNumber: 0, playStatus: false, speed: 1, currentTime: 0, duration: 0, speeds: [
						{ value: 0.25, label: "x 0.25" },
						{ value: 0.5, label: "x 0.5" },
						{ value: 1, label: "正常速度" },
						{ value: 1.5, label: "x 1.5" },
						{ value: 2, label: "x 2" },
					], timeShouldChange: true
				}
			},
			methods: {
				handleTimeChange(value) {
					if (value) {
						const time = Math.floor(value);
						this.currentTime = time;
						this.timeTo(value);
					}
				},
				getClosestIndex(arr, targetTime) {
					let closestIndex = 0;
					let closestDiff = Math.abs(
						targetTime - new Date(arr[0].frameTime).getTime()
					);
					for (let i = 1; i < arr.length; i++) {
						const diff = Math.abs(
							targetTime - new Date(arr[i].frameTime).getTime()
						);
						if (diff < closestDiff) {
							closestDiff = diff;
							closestIndex = i;
						}
					}
					return closestIndex;
				},
				timeTo(timestamp) {
					let realTimeStamp =
						new Date(fullTrack[0].frameTime).getTime() + timestamp;
					let index = this.getClosestIndex(fullTrack, realTimeStamp);
					dillPath = fullTrack.slice(index);
				},
				formatTime(time) {
					let fTime = Math.round(time / 1000)
					// 格式化时间的方法，将时间转换成分钟和秒钟的形式
					const minutes = Math.floor(fTime / 60);
					const seconds = Math.floor(fTime % 60);
					return `${minutes < 10 ? "0" + minutes : minutes}:${seconds < 10 ? "0" + seconds : seconds
						}`;
				},
				playClick() {
					this.playStatus = !this.playStatus;
					this.playStatus
						? this.continuePlay()
						: this.pause();
				},
				pause() {
					this.playStatus = false;
				},
				continuePlay() {
					this.playStatus = true;
					this.renderPath();
				},
				handleMouseDown() {
					this.timeShouldChange = false;
				},
				handleMouseUp() {
					this.timeShouldChange = true;
				},
				dialogOpen() {
					console.log('open');
					this.$nextTick(() => {
						const sliderElement = this.$refs.sliderRef.$el;
						sliderElement.addEventListener("mouseup", this.handleMouseUp);
						sliderElement.addEventListener("mousedown", this.handleMouseDown);
						dMap = new mapboxgl.Map({
							container: 'threeMapContainer',
							style: 'mapbox://styles/mapbox/dark-v11',
							center: [110.70727046509603, 33.05124063231834],
							zoom: 11,
							pitch: 45,
						});
						dMap.on("style.load", () => {
							dMap.addLayer({
								id: "vehicle3D",
								type: "custom",
								renderingMode: "3d",
								onAdd: (dMap, mbxContext) => {
									window.tb = new Threebox(dMap, mbxContext, {
										defaultLights: true,
										enableSelectingObjects: false,
									});
									for (let item of [1, 2, 3, 4, 5]) {
										let options = {
											obj: `model/car${item}.gltf`,
											type: "gltf",
											units: "meters",
											scale: 0.8,
											adjustment: { x: 0.5, y: 1, z: -0.5 },
											bbox: true,
										};
										window.tb.loadObj(options, (model) => {
											models[`car${item}`] = model;
											this.modelNumber += 1;
										});
									}
								},
								render: function (gl, matrix) {
									window.tb.update();
								},
							});
						});
						let interval = setInterval(() => {
							if (this.modelNumber === 5) {
								clearInterval(interval)
								fetch('libs/tracks.json').then(res => {
									res.json().then(result => {
										fullTrack = result.blog_tracks
										let fullTime =
											new Date(fullTrack[fullTrack.length - 1].frameTime).getTime() -
											new Date(fullTrack[0].frameTime).getTime();
										this.duration = fullTime;
										dillPath = JSON.parse(JSON.stringify(fullTrack));
										this.playStatus = true;
										dMap.flyTo({
											center: [
												dillPath[0].carInfo[0].longitude,
												dillPath[0].carInfo[0].latitude,
											],
											zoom: 19,
										});
										this.renderPath(true);
									})
								})
							}
						}, 500)
					})
				},
				renderPath(begin) {
					if (this.playStatus) {
						if (dillPath.length) {
							let currentFrame = dillPath[0].carInfo;
							let allData = this.diff(
								lastFrame.carInfo || [],
								currentFrame || []
							);
							let spend = new Date(dillPath[0].frameTime).getTime() - new Date(fullTrack[0].frameTime).getTime();
							this.timeShouldChange && (this.currentTime = spend);
							document.getElementById('slider-text').innerText = `${this.formatTime(this.currentTime)}/${this.formatTime(this.duration)}`
							let timeDiff = 0;
							if (!begin) {
								timeDiff =
									new Date(dillPath[0].frameTime).getTime() -
										new Date(lastFrame.frameTime).getTime() >
										1000
										? 100
										: new Date(dillPath[0].frameTime).getTime() -
										new Date(lastFrame.frameTime).getTime();
							}
							timeDiff = timeDiff / this.speed;
							lastFrame = Object.assign({}, dillPath[0], {
								carInfo: currentFrame,
							});
							this.addDelUpdateVehicleModels(allData, timeDiff);
							dillPath.shift();
							if (!dillPath.length) {
								dillPath = JSON.parse(JSON.stringify(fullTrack));
							}
							setTimeout(() => {
								this.renderPath(false);
							}, timeDiff);
						}
					}
				},
				addDelUpdateVehicleModels(allData, timeDiff) {
					if (window.tb && window.tb.world.children) {
						for (let item of allData) {
							// 新增
							if (item.dill === "add") {
								console.log(item.originalType);
								let model = models[`car${item.originalType}`].duplicate();
								model.setCoords([item.longitude, item.latitude]);
								model.userData.data = item;
								model.setRotation({ x: 90, y: 360 - item.courseAngle - 90, z: 0 });
								window.tb.add(model, item.id);
							}
							if (item.dill === "del") {
								window.tb.clear(item.id, true);
							}
							if (item.dill === "com") {
								for (let model of window.tb.world.children) {
									if (model.userData.data?.id === item.id) {
										this.setModel(model, item, timeDiff);
									}
								}
							}
						}
					}
				},
				setModel(model, options, timeDiff) {
					// model.traverse((child) => {
					// 	if (child.isMesh && child.name.includes("_19")) {
					// 		child.material = child.material.clone();
					// 		let realColor = colorMap[options.originalColor]
					// 		child.material.color.set(realColor);
					// 	}
					// });
					if (timeDiff === 0) {
						model.setCoords([options.longitude, options.latitude]);
					} else {
						let timeDiffInterval = timeDiff / 4;
						let midPoint = turf.midpoint(
							[model.userData.data.longitude, model.userData.data.latitude],
							[options.longitude, options.latitude]
						);
						let midBePoint = turf.midpoint(
							[model.userData.data.longitude, model.userData.data.latitude],
							midPoint.geometry.coordinates
						);
						let midAfPoint = turf.midpoint(midPoint.geometry.coordinates, [
							options.longitude,
							options.latitude,
						]);
						setTimeout(() => {
							model.setCoords(midBePoint.geometry.coordinates);
						}, timeDiffInterval);
						setTimeout(() => {
							model.setCoords(midPoint.geometry.coordinates);
						}, timeDiffInterval * 2);
						setTimeout(() => {
							model.setCoords(midAfPoint.geometry.coordinates);
						}, timeDiffInterval * 3);
						setTimeout(() => {
							model.setCoords([options.longitude, options.latitude]);
						}, timeDiffInterval * 4);
					}
					model.userData.data = options;
					model.setRotation({ x: 90, y: 360 - options.courseAngle - 90, z: 0 });
				},
				diff(oldData, newData) {
					const add = newData.filter((e) => !oldData.find((c) => c.id === e.id));
					const del = oldData.filter((e) => !newData.find((c) => c.id === e.id));
					const com = newData.filter((e) => oldData.find((c) => c.id === e.id));
					add.forEach((a) => (a.dill = "add"));
					del.forEach((d) => (d.dill = "del"));
					com.forEach((c) => (c.dill = "com"));
					return [...add, ...del, ...com];
				},
				closeDialog() {
					this.playStatus = false
					this.currentTime = 0
					this.duration = 0
					fullTrack = []
					dillPath = []
					lastFrame = {}
					window.tb?.dispose();
					dMap?.remove()
					window.tb = null
					dMap = null
					this.dialogVisible = false
				},
				openThree() {
					this.dialogVisible = true
				},
				// 添加地形
				addTerrain() {
					map.setTerrain({ 'source': 'mapbox-dem', 'exaggeration': 1.5 });
				},
				// 删除地形
				removeTerrain() {
					map.setTerrain(null);
				},
				addVectorLayer() {
					if (!map.getSource("vectorSource")) {
						map.addSource("vectorSource", {
							type: "vector",
							tiles: [
								this.vectorTileUrl,
							],
						});
					}
					if (!map.getLayer("vectorLayer")) {
						map.addLayer({
							id: "vectorLayer",
							type: "circle",
							source: "vectorSource",
							"source-layer": this.vectorSourceLayer,
							paint: {
								'circle-color': 'red',
								'circle-radius': 2
							}
						});
					}
				},
				removeVectorLayer() {
					map.getLayer("vectorLayer") && map.removeLayer("vectorLayer");
					map.getSource("vectorSource") && map.removeSource("vectorSource");
				},
				addRasterLayer() {
					if (!map.getLayer('customRaster-layer')) {
						let raster = {
							"id": 'customRaster-layer',
							"type": "raster",
							"source": {
								"type": "raster",
								"tiles": [this.rasterLayerUrl],
								"tileSize": 256
							}
						}
						map.addLayer(raster);
					} else {
						this.$notify.warning({
							title: '请先移除已存在栅格图层！'
						});
					}
				},
				removeRasterLayer() {
					if (map.getLayer('customRaster-layer')) {
						map.removeLayer('customRaster-layer')
						map.removeSource('customRaster-layer')
					}
					this.rasterLayerUrl = ''
				},
				clearGeojson(reset) {
					if (map.getLayer('customSource-layer')) {
						map.removeLayer('customSource-layer')
						map.removeSource('customSource')
					}
					reset && (this.drawGeojsonValue = '')
				},
				drawGeojson() {
					this.clearGeojson()
					if (this.drawGeojsonValue) {
						let data = turf.featureCollection(JSON.parse(this.drawGeojsonValue))
						if (map.getSource('customSource')) {
							map.getSource('customSource').setData(data)
						} else {
							map.addSource('customSource', {
								type: "geojson",
								data: data,
							})
							if (data.features[0].geometry.type === 'LineString') {
								map.addLayer(
									{
										id: "customSource-layer",
										type: "line",
										source: "customSource",
										paint: {
											'line-color': 'red',
											'line-width': 2
										},
									},
								)
							}
							if (data.features[0].geometry.type === 'Polygon') {
								map.addLayer(
									{
										id: "customSource-layer",
										type: "fill",
										source: "customSource",
										paint: {
											'fill-color': 'rgba(243, 15, 53,0.5)',
										},
									},
								)
							}
							if (data.features[0].geometry.type === 'Point') {
								map.addLayer(
									{
										id: "customSource-layer",
										type: "circle",
										source: "customSource",
										paint: {
											'circle-color': 'red',
											'circle-radius': 10
										},
									},
								)
							}
						}
					}
				},
				replaceStyle() {
					try {
						map.setStyle(this.styleValue);
					} catch (error) {
						this.$notify.error({
							title: '输入非法！',
							message: error
						});
					}
				},
				locate(e) {
					console.log(e);
					try {
						let point = this.lnglatStr.split(',')
						map.flyTo({
							center: point,
							zoom: 18,
						})
					} catch (error) {
						this.$notify.error({
							title: '输入非法！',
							message: error
						});
					}
				},
				copyResult() {
					const input = document.createElement('input')
					input.setAttribute('readonly', 'readonly')
					input.setAttribute('value', this.drawResultText)
					document.body.appendChild(input)
					input.setSelectionRange(0, 9999)
					input.select()
					document.execCommand('copy')
					document.body.removeChild(input)
					this.$notify.success({ title: '复制成功！' })
				}
			},
			mounted() {
				mapboxgl.accessToken = 'pk.eyJ1IjoibmluZ2x4IiwiYSI6ImNsYnlnM2s2ODBnNmIzcHBpbzY5aDh3bHAifQ.hQL4zLjBss5i4x-zuFp9tg';
				map = new mapboxgl.Map({
					container: 'map', // container ID
					style: 'mapbox://styles/mapbox/satellite-streets-v12', // style URL
					center: [110.70727046509603, 33.05124063231834], // starting position [lng, lat]
					zoom: 2, // starting zoom
				});
				var draw = new MapboxDraw({
					displayControlsDefault: false,
					controls: {
						polygon: true,
						line_string: true,
						point: true,
						trash: true
					}
				});
				map.addControl(draw);
				map.on('load', () => {
					map.on('click', (e) => {
						console.log(e.lngLat)
						console.log(map.getCenter());
						console.log(map.getBearing());
						console.log(map.getZoom());
						console.log(map.getPitch());
					})
					// setTimeout(() => {
					// 	map.flyTo({
					// 		center: [116.15090301724723, 40.006045007062],
					// 		bearing: -73.60786512235785,
					// 		zoom: 14.754889002122209,
					// 		pitch: 70.99850391694255
					// 	})
					// }, 2000)
				})
				map.on('style.load', () => {
					map.addSource('mapbox-dem', {
						'type': 'raster-dem',
						'url': 'mapbox://mapbox.mapbox-terrain-dem-v1',
						'tileSize': 512,
						'maxzoom': 14
					});
					// add the DEM source as a terrain layer with exaggerated height
					// this.addTerrain()
				})
				map.on('draw.create', (event) => {
					let geojson = JSON.stringify(event.features)
					this.drawResultText = geojson
				});

				// 监听 draw.update 事件
				map.on('draw.update', (event) => {
					let geojson = JSON.stringify(event.features)
					this.drawResultText = geojson
				});
			}
		})

	</script>
	</div>
</body>

</html>
      </div>
      
      
      
    </div>
    
  <ul class="breadcrumb">
          
            <li><a href="/demos/">DEMOS</a></li>
            <li><a href="/demos/edit/">EDIT</a></li>
          <li>MAPBOX</li>
        
  </ul>

    
    
    


          </div>
          
    
  <div class="comments">
    <div id="lv-container" data-id="city" data-uid="MTAyMC81NjA3MS8zMjUzNA=="></div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Ning lx"
      src="/images/avator.jpg">
  <p class="site-author-name" itemprop="name">Ning lx</p>
  <div class="site-description" itemprop="description">进击的菜鸡</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">28</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">19</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="http://wpa.qq.com/msgrd?v=3&uin=1181699158&site=qq&menu=yes" title="QQ → http:&#x2F;&#x2F;wpa.qq.com&#x2F;msgrd?v&#x3D;3&amp;uin&#x3D;1181699158&amp;site&#x3D;qq&amp;menu&#x3D;yes" rel="noopener" target="_blank"><i class="fab fa-qq fa-fw"></i>QQ</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://github.com/ninglx" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ninglx" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:n1181699158@gmail.com" title="GMail → mailto:n1181699158@gmail.com" rel="noopener" target="_blank"><i class="fab fa-google fa-fw"></i>GMail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.facebook.com/ninglix" title="FaceBook → https:&#x2F;&#x2F;www.facebook.com&#x2F;ninglix" rel="noopener" target="_blank"><i class="fab fa-facebook fa-fw"></i>FaceBook</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://stackoverflow.com/users/19733658/ninglx" title="StackOverflow → https:&#x2F;&#x2F;stackoverflow.com&#x2F;users&#x2F;19733658&#x2F;ninglx" rel="noopener" target="_blank"><i class="fab fa-stack-overflow fa-fw"></i>StackOverflow</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.youtube.com/@ninglx" title="YouTube → https:&#x2F;&#x2F;www.youtube.com&#x2F;@ninglx" rel="noopener" target="_blank"><i class="fab fa-youtube fa-fw"></i>YouTube</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
<div class="copyright">
  
  &copy; 2022 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ning lx</span>
</div>

<!--
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>-->

<span>
  本站已运行
  <span id="showDays"></span>
</span>
<script>
  var seconds = 1000;
  var minutes = seconds * 60;
  var hours = minutes * 60;
  var days = hours * 24;
  var years = days * 365;
  var birthDay = Date.UTC(2022,04,11,14,00,00); // 这里设置建站时间
  setInterval(function() {
    var today = new Date();
    var todayYear = today.getFullYear();
    var todayMonth = today.getMonth()+1;
    var todayDate = today.getDate();
    var todayHour = today.getHours();
    var todayMinute = today.getMinutes();
    var todaySecond = today.getSeconds();
    var now = Date.UTC(todayYear,todayMonth,todayDate,todayHour,todayMinute,todaySecond);
    var diff = now - birthDay;
    var diffYears = Math.floor(diff/years);
    var diffDays = Math.floor((diff/days)-diffYears*365);
    var diffHours = Math.floor((diff-(diffYears*365+diffDays)*days)/hours);
    var diffMinutes = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours)/minutes);
    var diffSeconds = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours-diffMinutes*minutes)/seconds);
      document.getElementById('showDays').innerHTML=""+diffYears+" 年 "+diffDays+" 天 "+diffHours+" 小时 "+diffMinutes+" 分钟 "+diffSeconds+" 秒 ";
  }, 1000);
</script>
        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script size="300" alpha="0.6" zIndex="-1" src="/lib/canvas-ribbon/canvas-ribbon.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

<script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  window.livereOptions = {
    refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script>

</body>
</html>
